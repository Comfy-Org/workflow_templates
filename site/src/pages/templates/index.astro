---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import TemplateCard from '../../components/TemplateCard.astro';
import { getLocaleFromPath, localizeUrl } from '../../i18n/utils';
import { t } from '../../i18n/ui';
import { absoluteUrl } from '../../config/site';

const locale = getLocaleFromPath(Astro.url.pathname);
const templates = await getCollection('templates');
const sortedTemplates = templates
  .filter((tmpl) => !tmpl.id.includes('/'))
  .sort((a, b) => (b.data.usage || 0) - (a.data.usage || 0));

const canonicalUrl = absoluteUrl(localizeUrl('/templates/', locale));

const structuredData = {
  '@context': 'https://schema.org',
  '@type': 'CollectionPage',
  name: t('meta.title', locale),
  description: t('meta.description', locale),
  url: canonicalUrl,
};
---

<BaseLayout
  title={`${t('meta.title', locale)} - Free AI Generation Workflows`}
  description={t('meta.description', locale)}
  canonicalUrl={canonicalUrl}
  ogImage="/og-default.png"
  structuredData={structuredData}
  theme="dark"
>
  <div class="max-w-6xl mx-auto px-4 py-12">
    <!-- Header -->
    <div class="text-center mb-12">
      <h1 class="text-4xl sm:text-5xl font-bold text-white mb-4">
        {t('nav.templates', locale)}
      </h1>
      <p class="text-xl text-white/70 max-w-2xl mx-auto">
        {t('meta.description', locale)}
      </p>
    </div>

    <!-- Stats bar -->
    <div class="flex justify-center gap-8 mb-12 text-sm text-white/50">
      <span class="flex items-center gap-2">
        <span class="w-2 h-2 bg-green-500 rounded-full"></span>
        {sortedTemplates.length}
        {t('template.count', locale)}
      </span>
      <span>{t('template.updated', locale)}</span>
    </div>

    <!-- Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {
        sortedTemplates.map((template) => (
          <TemplateCard
            name={template.data.name}
            title={template.data.title || template.data.name}
            description={template.data.description}
            mediaType={template.data.mediaType}
            mediaSubtype={template.data.mediaSubtype}
            thumbnailVariant={template.data.thumbnailVariant}
            tags={template.data.tags}
            models={template.data.models}
            usage={template.data.usage}
            date={template.data.date}
            thumbnails={template.data.thumbnails}
            locale={locale}
          />
        ))
      }
    </div>
  </div>
</BaseLayout>
