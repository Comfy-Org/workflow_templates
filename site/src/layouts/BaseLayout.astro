---
import Analytics from '@vercel/analytics/astro';
import SEOHead from '../components/SEOHead.astro';
import '../styles/global.css';
import { LANGUAGES, type Locale } from '../i18n/config';
import { getLocaleFromPath } from '../i18n/utils';


interface Props {
  title: string;
  description: string;
  canonicalUrl?: string;
  ogImage?: string;
  ogType?: 'website' | 'article';
  structuredData?: object;
  locale?: Locale;
  hreflangBasePath?: string;
  theme?: 'light' | 'dark';
  hideDefaultFooter?: boolean;
}

const {
  title,
  description,
  canonicalUrl,
  ogImage,
  ogType,
  structuredData,
  locale: propLocale,
  hreflangBasePath,
  theme = 'light',
  hideDefaultFooter = false,
} = Astro.props;

const hasCustomFooter = Astro.slots.has('footer');

// Detect locale from URL if not provided
const locale = propLocale || getLocaleFromPath(Astro.url.pathname);
const langInfo = LANGUAGES[locale];
const htmlDir = langInfo?.dir || 'ltr';

// Theme-aware classes
const isDark = theme === 'dark';
const bodyClasses = isDark
  ? 'min-h-screen flex flex-col bg-page text-content antialiased'
  : 'min-h-screen flex flex-col bg-white text-gray-900 antialiased'
---

<!doctype html>
<html lang={locale} dir={htmlDir} class="scroll-smooth">
  <head>
    <SEOHead
      title={title}
      description={description}
      canonicalUrl={canonicalUrl}
      ogImage={ogImage}
      ogType={ogType}
      structuredData={structuredData}
      locale={locale}
      hreflangBasePath={hreflangBasePath}
    />
    <slot name="head" />
  </head>
  <body class={bodyClasses}>
    
    <main class="flex-1">
      <slot />
    </main>

    {
      hasCustomFooter || hideDefaultFooter ? (
        <slot name="footer" />
      ) : (
        <footer >
          {/* footer here */}
        </footer>
      )
    }
    <Analytics />
    <script>
      import('../scripts/vitals');
    </script>
  </body>
</html>
